<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Card Ground Truth Annotator</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, system-ui, sans-serif; background: #1a1a2e; color: #eee; padding: 20px; }
  h1 { margin-bottom: 8px; }
  .subtitle { color: #888; margin-bottom: 20px; font-size: 14px; }
  .stats { background: #16213e; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 20px; font-size: 14px; }
  .stats span { color: #0f0; }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(480px, 1fr)); gap: 16px; }
  .card { background: #16213e; border-radius: 8px; overflow: hidden; border: 2px solid transparent; }
  .card.done { border-color: #0f03; }
  .card.existing { border-color: #ff0; opacity: 0.6; }
  .card img { width: 100%; display: block; cursor: pointer; }
  .card img.zoomed { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: auto; max-width: 95vw; max-height: 95vh; z-index: 1000; border-radius: 8px; box-shadow: 0 0 40px rgba(0,0,0,0.8); }
  .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 999; display: none; }
  .overlay.active { display: block; }
  .info { padding: 12px; }
  .ts { font-size: 12px; color: #888; margin-bottom: 8px; font-family: monospace; }
  .fields { display: flex; gap: 8px; margin-bottom: 8px; }
  .fields label { font-size: 12px; color: #aaa; display: block; margin-bottom: 2px; }
  .fields input { background: #0d1b3e; border: 1px solid #333; color: #fff; padding: 6px 8px; border-radius: 4px; font-family: monospace; font-size: 14px; width: 100%; }
  .fields input:focus { border-color: #4a9eff; outline: none; }
  .fields input.prefilled { border-color: #ff0; }
  .field { flex: 1; }
  .hint { font-size: 11px; color: #666; margin-bottom: 8px; }
  .actions { display: flex; gap: 8px; margin-bottom: 20px; }
  button { background: #4a9eff; color: #fff; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; }
  button:hover { background: #3a8eef; }
  button.secondary { background: #333; }
  button.secondary:hover { background: #444; }
  #output { background: #0d1b3e; padding: 16px; border-radius: 8px; font-family: monospace; font-size: 12px; white-space: pre-wrap; display: none; max-height: 400px; overflow-y: auto; margin-top: 16px; }
  .skip-btn { background: #333; color: #888; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; }
  .skip-btn:hover { background: #444; color: #fff; }
</style>
</head>
<body>

<h1>Card Ground Truth Annotator</h1>
<p class="subtitle">Click an image to zoom. Fill in hero cards (e.g., "Kd 4d") and community cards (e.g., "Qs Jc Th" or empty for preflop). Yellow borders = already has ground truth.</p>

<div class="stats" id="stats"></div>

<div class="actions">
  <button onclick="exportGroundTruth()">Export TypeScript</button>
  <button class="secondary" onclick="exportJSON()">Export JSON</button>
  <button class="secondary" onclick="showOnlyNew()">Show Only New</button>
  <button class="secondary" onclick="showAll()">Show All</button>
</div>

<div class="grid" id="grid"></div>
<pre id="output"></pre>
<div class="overlay" id="overlay" onclick="closeZoom()"></div>

<script>
const EXISTING_TRUTH = {
  "2026-02-17T13-37-28-840Z": { hero: ["Kc", "Jd"], community: [] },
  "2026-02-17T13-37-56-433Z": { hero: ["Kc", "Jd"], community: ["Ah", "4h", "Jc"] },
  "2026-02-17T13-38-53-206Z": { hero: ["8c", "Qc"], community: [] },
  "2026-02-17T13-39-01-369Z": { hero: ["8c", "Qc"], community: [] },
  "2026-02-17T13-39-46-183Z": { hero: ["8c", "Qc"], community: ["Jc", "5c", "2s", "3d"] },
  "2026-02-17T13-40-46-504Z": { hero: ["Qh", "10h"], community: [] },
  "2026-02-17T13-41-08-096Z": { hero: ["Qh", "10h"], community: ["Kc", "4h", "9h"] },
  "2026-02-17T13-41-25-899Z": { hero: ["Qh", "10h"], community: ["Kc", "4h", "9h", "Qs"] },
  "2026-02-17T13-44-37-752Z": { hero: ["Qd", "Qs"], community: [] },
  "2026-02-17T14-25-45-727Z": { hero: ["3d", "5c"], community: [] },
  "2026-02-17T14-26-05-475Z": { hero: ["Ah", "Jd"], community: [] },
  "2026-02-17T14-26-56-012Z": { hero: ["Ah", "Jd"], community: ["Qc", "10h", "5h"] },
  "2026-02-17T14-27-22-803Z": { hero: ["Ah", "Jd"], community: ["Qc", "10h", "5h", "Kh"] },
  "2026-02-17T14-28-23-356Z": { hero: ["4s", "3s"], community: [] },
  "2026-02-17T14-31-56-491Z": { hero: ["4c", "7h"], community: [] },
  "2026-02-17T14-35-15-232Z": { hero: ["Kh", "6h"], community: ["2c", "4d", "3s", "9d"] },
  "2026-02-17T14-36-28-902Z": { hero: ["Ks", "Kd"], community: [] },
  "2026-02-17T22-03-53-545Z": { hero: ["Qc", "3c"], community: [] },
  "2026-02-17T23-34-25-924Z": { hero: ["Ad", "9d"], community: [] },
  "2026-02-17T23-36-03-587Z": { hero: ["10s", "Qs"], community: [] },
  "2026-02-17T23-36-29-216Z": { hero: ["Ad", "10h"], community: [] },
  "2026-02-18T10-37-19-292Z": { hero: ["2d", "8h"], community: [] },
  "2026-02-18T10-37-28-999Z": { hero: ["6d", "As"], community: [] },
  "2026-02-18T10-37-57-625Z": { hero: ["6d", "As"], community: ["Jh", "Qd", "4s"] },
  "2026-02-18T10-38-07-553Z": { hero: ["Ad", "3s"], community: [] },
  "2026-02-18T10-39-09-673Z": { hero: ["Ad", "3s"], community: ["3d", "5s", "3c", "Kd", "10h"] },
  "2026-02-18T10-40-46-393Z": { hero: ["Kd", "7h"], community: [] },
  "2026-02-18T10-41-50-700Z": { hero: ["10c", "7s"], community: [] },
  "2026-02-18T10-42-29-143Z": { hero: ["Kc", "3d"], community: [] },
  "2026-02-18T10-43-46-462Z": { hero: ["4d", "9h"], community: [] },
  "2026-02-18T10-43-49-827Z": { hero: ["4d", "9h"], community: [] },
  "2026-02-18T10-44-19-671Z": { hero: ["Ah", "7c"], community: [] },
  "2026-02-18T10-44-42-297Z": { hero: ["Ah", "7c"], community: ["5s", "6c", "9c", "3s"] },
  "2026-02-18T10-45-07-857Z": { hero: ["Ah", "7c"], community: ["5s", "6c", "9c", "3s", "8h"] },
  "2026-02-18T10-45-53-473Z": { hero: ["4c", "6d"], community: [] },
  "2026-02-18T10-46-34-098Z": { hero: ["10h", "6d"], community: [] },
  "2026-02-18T10-47-01-507Z": { hero: ["10h", "6d"], community: ["Kd", "2d"] },
  "2026-02-18T10-48-10-309Z": { hero: ["6s", "Js"], community: [] },
  "2026-02-18T10-48-45-232Z": { hero: ["6s", "Js"], community: ["Qs", "Jc", "7d"] },
  "2026-02-18T10-49-12-759Z": { hero: ["6s", "Js"], community: ["Qs", "Jc", "7d"] },
  "2026-02-18T10-49-35-186Z": { hero: ["4d", "7s"], community: [] },
  "2026-02-18T10-49-46-086Z": { hero: ["Kh", "2c"], community: [] },
  "2026-02-18T10-50-08-775Z": { hero: ["Qh", "Kh"], community: [] },
  "2026-02-18T10-50-50-026Z": { hero: ["Qh", "Kh"], community: ["4h", "2c", "3c", "3d", "5s"] },
  "2026-02-18T10-51-06-252Z": { hero: ["6d", "Kc"], community: [] },
  "2026-02-18T10-51-40-478Z": { hero: ["7d", "9c"], community: [] },
  "2026-02-18T15-44-06-337Z": { hero: ["6h", "9d"], community: [] },
  "2026-02-18T15-45-06-776Z": { hero: ["Kc", "6s"], community: [] },
  "2026-02-18T15-45-48-695Z": { hero: ["2c", "Qs"], community: [] },
  "2026-02-18T15-46-34-073Z": { hero: ["Ks", "Jd"], community: ["Js", "Qs", "Qc"] },
  "2026-02-18T15-47-00-184Z": { hero: ["Jc", "6s"], community: [] },
  "2026-02-18T15-48-01-165Z": { hero: ["8s", "6s"], community: ["7h", "Ks", "4d"] },
  "2026-02-18T15-48-16-604Z": { hero: ["7h", "Ks"], community: [] },
  "2026-02-18T15-48-55-787Z": { hero: ["6h", "9s"], community: [] },
  "2026-02-18T15-51-32-786Z": { hero: ["3c", "4d"], community: [] },
  "2026-02-18T15-52-05-025Z": { hero: ["Ah", "5c"], community: [] },
  "2026-02-18T15-52-23-263Z": { hero: ["Ah", "5c"], community: ["Kh", "2s", "4h"] },
  "2026-02-18T15-53-18-699Z": { hero: ["Kd", "4d"], community: [] },
  "2026-02-18T15-54-01-221Z": { hero: ["Kd", "4d"], community: [] },
  "2026-02-18T15-57-08-263Z": { hero: ["Jd", "Kd"], community: ["5h", "6d", "3c"] },
  "2026-02-18T15-58-57-934Z": { hero: ["Jd", "5s"], community: [] },
  "2026-02-18T15-59-35-269Z": { hero: ["10c", "As"], community: [] },
  "2026-02-18T16-00-18-105Z": { hero: ["6h", "9h"], community: [] },
  "2026-02-18T16-01-20-418Z": { hero: ["Qs", "4d"], community: [] },
  "2026-02-18T20-59-05-858Z": { hero: ["Jh", "7h"], community: ["2d", "9c", "Kh"] },
  "2026-02-18T20-59-42-676Z": { hero: ["2c", "4c"], community: [] },
  "2026-02-18T21-02-22-794Z": { hero: ["6d", "4d"], community: [] },
  "2026-02-18T21-05-35-707Z": { hero: ["Ah", "4h"], community: [] },
  "2026-02-18T21-05-49-236Z": { hero: ["Ah", "4h"], community: ["3d", "Kh", "Qc"] },
  "2026-02-18T21-09-46-179Z": { hero: ["Qc", "Kd"], community: [] },
  "2026-02-18T21-10-51-658Z": { hero: ["6d", "9d"], community: [] },
  "2026-02-18T21-12-43-998Z": { hero: ["8d", "7d"], community: [] },
  "2026-02-18T21-15-49-607Z": { hero: ["Kc", "2c"], community: [] },
  "2026-02-18T21-16-31-773Z": { hero: ["4s", "Jh"], community: [] },
  "2026-02-18T21-17-12-546Z": { hero: ["5c", "6s"], community: [] },
  "2026-02-18T21-19-11-614Z": { hero: ["2h", "As"], community: [] },
  "2026-02-18T21-20-26-647Z": { hero: ["Kc", "6s"], community: [] },
  "2026-02-18T21-20-38-483Z": { hero: ["Kc", "6s"], community: [] },
  "2026-02-18T21-21-25-390Z": { hero: ["Kh", "4h"], community: [] },
  "2026-02-18T21-21-49-743Z": { hero: ["Kh", "4h"], community: ["Kd", "Kc", "9c"] },
  "2026-02-18T21-21-53-638Z": { hero: ["Kh", "4h"], community: ["Kd", "Kc", "9c", "4s"] },
  "2026-02-18T21-25-21-930Z": { hero: ["Qh", "Ah"], community: [] },
  "2026-02-18T21-25-42-106Z": { hero: ["Qh", "Ah"], community: [] },
  "2026-02-18T21-25-43-633Z": { hero: ["Qh", "Ah"], community: [] },
  "2026-02-18T21-26-15-151Z": { hero: ["Qh", "Ah"], community: [] },
  "2026-02-18T21-26-43-523Z": { hero: ["Qh", "Ah"], community: [] },
};

const CAPTURES = ["2026-02-17T13-37-28-840Z","2026-02-17T13-37-56-433Z","2026-02-17T13-38-53-206Z","2026-02-17T13-39-01-369Z","2026-02-17T13-39-46-183Z","2026-02-17T13-40-46-504Z","2026-02-17T13-41-08-096Z","2026-02-17T13-41-25-899Z","2026-02-17T13-44-37-752Z","2026-02-17T14-25-45-727Z","2026-02-17T14-26-05-475Z","2026-02-17T14-26-56-012Z","2026-02-17T14-27-22-803Z","2026-02-17T14-28-23-356Z","2026-02-17T14-31-56-491Z","2026-02-17T14-35-15-232Z","2026-02-17T14-36-28-902Z","2026-02-17T22-03-53-545Z","2026-02-17T23-34-25-924Z","2026-02-17T23-36-03-587Z","2026-02-17T23-36-29-216Z","2026-02-18T10-37-19-292Z","2026-02-18T10-37-28-999Z","2026-02-18T10-37-57-625Z","2026-02-18T10-38-07-553Z","2026-02-18T10-39-09-673Z","2026-02-18T10-40-46-393Z","2026-02-18T10-41-50-700Z","2026-02-18T10-42-29-143Z","2026-02-18T10-43-46-462Z","2026-02-18T10-43-49-827Z","2026-02-18T10-44-19-671Z","2026-02-18T10-44-42-297Z","2026-02-18T10-45-07-857Z","2026-02-18T10-45-53-473Z","2026-02-18T10-46-34-098Z","2026-02-18T10-47-01-507Z","2026-02-18T10-47-29-405Z","2026-02-18T10-48-10-309Z","2026-02-18T10-48-45-232Z","2026-02-18T10-49-12-759Z","2026-02-18T10-49-35-186Z","2026-02-18T10-49-46-086Z","2026-02-18T10-50-08-775Z","2026-02-18T10-50-50-026Z","2026-02-18T10-51-06-252Z","2026-02-18T10-51-40-478Z","2026-02-18T15-43-57-146Z","2026-02-18T15-44-06-337Z","2026-02-18T15-45-06-776Z","2026-02-18T15-45-48-695Z","2026-02-18T15-46-34-073Z","2026-02-18T15-47-00-184Z","2026-02-18T15-48-01-165Z","2026-02-18T15-48-16-604Z","2026-02-18T15-48-55-787Z","2026-02-18T15-51-32-786Z","2026-02-18T15-52-05-025Z","2026-02-18T15-52-23-263Z","2026-02-18T15-53-13-870Z","2026-02-18T15-53-18-699Z","2026-02-18T15-54-01-221Z","2026-02-18T15-57-08-263Z","2026-02-18T15-58-57-934Z","2026-02-18T15-59-13-650Z","2026-02-18T15-59-30-992Z","2026-02-18T15-59-35-269Z","2026-02-18T16-00-18-105Z","2026-02-18T16-01-20-418Z","2026-02-18T16-01-41-462Z","2026-02-18T20-58-23-346Z","2026-02-18T20-58-39-388Z","2026-02-18T20-59-05-858Z","2026-02-18T20-59-42-676Z","2026-02-18T21-00-31-900Z","2026-02-18T21-02-22-794Z","2026-02-18T21-03-54-677Z","2026-02-18T21-05-02-221Z","2026-02-18T21-05-10-777Z","2026-02-18T21-05-35-707Z","2026-02-18T21-05-49-236Z","2026-02-18T21-09-46-179Z","2026-02-18T21-10-51-658Z","2026-02-18T21-12-43-998Z","2026-02-18T21-15-49-607Z","2026-02-18T21-16-31-773Z","2026-02-18T21-17-12-546Z","2026-02-18T21-19-11-614Z","2026-02-18T21-20-26-647Z","2026-02-18T21-20-38-483Z","2026-02-18T21-21-25-390Z","2026-02-18T21-21-49-743Z","2026-02-18T21-21-53-638Z","2026-02-18T21-25-21-930Z","2026-02-18T21-25-42-106Z","2026-02-18T21-25-43-633Z","2026-02-18T21-26-15-151Z","2026-02-18T21-26-43-523Z"];

let showingNew = false;

function init() {
  const grid = document.getElementById('grid');

  CAPTURES.forEach(ts => {
    const existing = EXISTING_TRUTH[ts];
    const div = document.createElement('div');
    div.className = 'card' + (existing ? ' existing' : '');
    div.dataset.ts = ts;

    const heroVal = existing ? existing.hero.join(' ') : '';
    const commVal = existing ? existing.community.join(' ') : '';

    div.innerHTML = `
      <img src="captures/${ts}.png" alt="${ts}" onclick="toggleZoom(this)">
      <div class="info">
        <div class="ts">${ts}</div>
        <div class="fields">
          <div class="field">
            <label>Hero cards</label>
            <input type="text" class="hero-input ${existing ? 'prefilled' : ''}"
                   value="${heroVal}" placeholder="e.g. Kd 4d"
                   data-ts="${ts}" onchange="markDone(this)">
          </div>
          <div class="field">
            <label>Community cards</label>
            <input type="text" class="comm-input ${existing ? 'prefilled' : ''}"
                   value="${commVal}" placeholder="empty = preflop"
                   data-ts="${ts}" onchange="markDone(this)">
          </div>
        </div>
        ${existing ? '<div class="hint">Already has ground truth (yellow = prefilled)</div>' : '<div class="hint">NEW - needs annotation</div>'}
      </div>
    `;
    grid.appendChild(div);
  });

  updateStats();
}

function markDone(input) {
  const card = input.closest('.card');
  const hero = card.querySelector('.hero-input').value.trim();
  if (hero) card.classList.add('done');
  else card.classList.remove('done');
  updateStats();
}

function updateStats() {
  const total = CAPTURES.length;
  const existingCount = CAPTURES.filter(ts => EXISTING_TRUTH[ts]).length;
  const newCount = total - existingCount;
  const filledNew = document.querySelectorAll('.card:not(.existing).done').length;
  document.getElementById('stats').innerHTML =
    `Total: ${total} | Existing: <span>${existingCount}</span> | New: ${newCount} | Annotated: <span>${filledNew}/${newCount}</span>`;
}

function showOnlyNew() {
  document.querySelectorAll('.card.existing').forEach(c => c.style.display = 'none');
  showingNew = true;
}

function showAll() {
  document.querySelectorAll('.card.existing').forEach(c => c.style.display = '');
  showingNew = false;
}

function toggleZoom(img) {
  if (img.classList.contains('zoomed')) {
    closeZoom();
  } else {
    closeZoom();
    img.classList.add('zoomed');
    document.getElementById('overlay').classList.add('active');
  }
}

function closeZoom() {
  document.querySelectorAll('img.zoomed').forEach(i => i.classList.remove('zoomed'));
  document.getElementById('overlay').classList.remove('active');
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeZoom(); });

function collectAll() {
  const result = {};
  document.querySelectorAll('.card').forEach(card => {
    const ts = card.dataset.ts;
    const hero = card.querySelector('.hero-input').value.trim();
    const comm = card.querySelector('.comm-input').value.trim();
    if (!hero) return;
    result[ts] = {
      hero: hero.split(/\s+/),
      community: comm ? comm.split(/\s+/) : []
    };
  });
  return result;
}

function exportGroundTruth() {
  const data = collectAll();
  const lines = Object.entries(data)
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([ts, v]) => {
      const hero = JSON.stringify(v.hero);
      const comm = JSON.stringify(v.community);
      return `  "${ts}": { hero: ${hero}, community: ${comm} },`;
    });

  const out = `const GROUND_TRUTH: Record<string, { hero: string[]; community: string[] }> = {\n${lines.join('\n')}\n};`;
  const el = document.getElementById('output');
  el.style.display = 'block';
  el.textContent = out;
  el.scrollIntoView({ behavior: 'smooth' });
}

function exportJSON() {
  const data = collectAll();
  const el = document.getElementById('output');
  el.style.display = 'block';
  el.textContent = JSON.stringify(data, null, 2);
  el.scrollIntoView({ behavior: 'smooth' });
}

init();
</script>
</body>
</html>
